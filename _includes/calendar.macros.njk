{% import "utility.macros.njk" as utility %}


{% macro list(
  data
) %}
  {% for group, list in data | groupby('group')  | dictsort | reverse %}
    {% if list | length %}
      <section data-calendar="group">
        <h2
          data-calendar="grouper"
          data-theme="invert">
          {{ group }}
        </h2>
        <ol
          data-calendar="list"
          reversed>
          {% for item in list | sort(true, false, 'date') %}
            {{ show(item) }}
          {% endfor %}
        </ol>
      </section>
    {% endif %}
  {% endfor %}
{% endmacro %}

{% macro show(
  item
) %}
  {% if item.page %}
    {{ event(
      title=item.venue,
      url=item.page.url,
      date=item.date,
      hero=item.page.data.hero
    ) }}
  {% else %}
    {% set title = item.data.banner.title if item.data.banner else none %}
    {{ event(
      title=title or item.data.title,
      url=item.url,
      date=item.date,
      hero=item.data.hero
    ) }}
  {% endif %}
{% endmacro %}

{% macro event(
  title,
  url,
  date,
  hero=none
) %}
  <li
    data-calendar="item">
    <time data-item="date">
      {{ date | formatDate('url') }}
    </time>
    <h3 data-item="title">
      {{ utility.link_if(title, url) }}
    </h3>
  </li>
{% endmacro %}

{# {% if hero %}
  <li
    data-calendar="hero">
    <a
      href="{{ url | url }}"
      style="--image: url(/assets/images/{{ hero.img }})">
      <span hidden>
        {{ hero.caption or hero.alt or title }}
      </span>
    </a>
  </li>
{% endif %} #}
