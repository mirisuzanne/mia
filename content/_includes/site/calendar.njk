{% import "utility.macros.njk" as utility %}
{% import "events/macros.njk" as event_macros %}

{% set get_calendar = index or renderData.calendar or calendar or series %}

{% if get_calendar == 'all' %}
  {% set filters %}
    {{ utility.tag_list(
      collections | sortTags,
      collections.all
    ) }}
    ({{ utility.link_if('more', '/tags/') }})
  {% endset %}

  {{ event_macros.section(
    title=utility.section_title('filter by...', filters),
    events=collections.all | getEvents,
    all=collections.all,
    self=page.url
  ) }}
{% elif get_calendar %}
  {% set title %}
    more in '{{ get_calendar }}'…
  {% endset %}

  {{ event_macros.section(
    title=utility.section_title(title),
    events=collections.all | getEvents(get_calendar),
    all=collections.all,
    self=page.url
  ) }}
{% elif events %}
  {{ event_macros.section(
    title=utility.section_title('as seen at…'),
    events=collections.all | getPage(page) | getEvents,
    all=collections.all,
    self=page.url
  ) }}
{% endif %}
