{% import "utility.macros.njk" as utility %}


{% macro main(
  content,
  section=none,
  erasure=false,
  page=true
) %}
  {% if content %}
    <main
      data-area="main-left"
      data-flow="grid">
      {{ inner(content, section, erasure) if page else content | safe }}
    </main>
  {% endif %}
{% endmacro %}


{% macro inner(
  content,
  section,
  erasure
) %}
  <div
    data-main
    {{ utility.attr_if('data-section', section.name or 'content') }}
    {{ utility.attr_if('data-area', section.area or true) }}
    {{ utility.style_if(section.style) }}>
    <div
      {{ utility.attr_if('data-content', section.content or true) }}
      {{ utility.attr_if('data-flow', section.flow) }}
      {{ utility.attr_if('data-erase', 'off' if erasure else none) }}
      data-typeset>
      {{ content | typogr | safe }}
    </div>
  </div>
{% endmacro %}


{% macro site_nav(
  items,
  page
) %}
  {% for name, url in items %}
    {{ nav_link(name, url, page) }}
  {% endfor %}
{% endmacro %}


{% macro tag_nav(
  collections,
  page
) %}
  {% for tag in collections | getTags(null) %}
    {% set current = page | hasTag(tag) if page.data else none %}
    {% set url = tag | tagLink(collections) %}
    {% if (loop.index < 7) or current or (page.url == url) %}
      {{ nav_link(
        name=tag | displayName,
        url=url,
        page=page,
        current=current
      ) }}
    {% endif %}
  {% endfor %}

  {{ nav_link(
    name='tagsâ€¦',
    url='/tags/',
    page=page
  ) }}
{% endmacro %}


{% macro nav_link(
  name,
  url,
  page,
  current=none
) %}
  {% set attrs = {
    'data-nav': name | slug,
    'data-current': current,
    'data-active': (page.url == url),
    'rel': ('home' if url == '/' else none)
  } %}

  <a
    href="{{ url | url }}"
    {{ utility.show_attrs(attrs) }}>
    {{ name }}
  </a>
{% endmacro %}
