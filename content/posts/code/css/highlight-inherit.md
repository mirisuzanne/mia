---
draft: true
title: Custom properties, inheritance, and highlights
sub: Sometimes there's no right answer
date: 2023-07-19
summary: >
  There have been a number of articles lately
  about highlight and backdrop pseudo-elements
  not inheriting custom properties from the root element.
  In both cases, the CSS Working Group is fixing the specs,
  but the highlight behavior might still surprise you.
---

{% import 'content.macros.njk' as content %}

These are actually two very distinct issues,
but they had the same 'result' for CSS authors.

## Backdrops, an easy fix

The `::backdrop` pseudo-element
is generated by any element
rendered in the
'[top layer](https://developer.mozilla.org/en-US/docs/Glossary/Top_layer)',
such as modal `dialog` elements.
That was originally defined
as part of the [HTML Fullscreen API](https://fullscreen.spec.whatwg.org/).
That spec said:

> [The `::backdrop` pseudo-element]
> does not inherit from any element
> and is not inherited from.
> No restrictions are made on what
> properties apply to this pseudo-element either.

That's fine for most properties,
but we rely heavily on inheritance
for _custom properties_ â€“
we define them on `:root` or `html`,
and expect them to be available everywhere.
If the `::backdrop`
'_does not inherit from any element_',
then it doesn't have access to our custom properties:

```css
html {
  --overlay: hsl(0deg 0% 0% / 0.9);
}

::backdrop {
  /* --overlay isn't defined here?!? */
  background: var(--overlay);
}
```

It's not clear to me
why `::backdrop` was defined that way,
but it was fixed recently without any fanfare.
When the definitions of top layer and `::backdrop`
were moved
[into the CSS specification](https://drafts.csswg.org/css-position-4/#backdrop),
that language was changed:

> The `::backdrop` pseudo-element
> is a tree-abiding pseudo-element.
> It accepts all properties.
> It inherits from its originating element.

Properties of a `dialog`
will now inherit on the `::backdrop`.
That includes properties that inherit
all the way from `:root`/`html`.
The issue is fixed in the spec,
and should work as expected
once browsers roll out an update.

## We kinda fixed Highlights, but it's complicated

If you use a chromium browser
with 'experimental web platform features' turned on,
you may have noticed a similar issue recently
with 'highlight pseudos'
such as `::selection`.
A recent update broke selection
on many of the sites I use,
and nearly all the sites I maintain --
including this one!

I (like many others)
had defined the `::selection` background
to rely on custom properties
inheriting from root.
Something like this:

```css
html {
  /* these might change based on light/dark mode, etc */
  --highlight-bg: maroon;
  --highlight-text: white;
}

::selection {
  background: var(--highlight-bg);
  color: var(--highlight-text);
}
```

The `::selection` pseudo-element
has been around for a long time,
and was originally defined to
_inherits from its originating element_.
That's the current (legacy) behavior,
supported in most browsers.

This approach even has some advantages,
since we can use custom properties,
and update their values anywhere in the DOM:

{{ content.codepen(
  id='NWEzxNz',
  title='Selections and inheritance (legacy advantages)',
  user='miriamsuzanne'
) }}

Pretty cool!
Custom properties inherit,
my code works great,
and the whole world is at peace.
So why would we break it?!

### The problem with highlight inheritance

These two selectors are the same:

```css
::selection { /* The universal `*` is implied */ }
*::selection { /* We can make it explicit */ }
```

With either selector above,
we are targeting _every_ `::selection`
on _every element_.
That selector works well in legacy browsers
because it applies the same styles
on every `::selection`,
and only the custom properties are inheriting.

But there's a problem
if we try to apply different styles
to selected text in different elements.
Currently, styles on `main::selection`
will not apply to selected text
in any elements _nested inside_ `main`:

{{ content.codepen(
  id='VwVdYmP',
  title='Selections and inheritance (legacy issues)',
  user='miriamsuzanne'
) }}

